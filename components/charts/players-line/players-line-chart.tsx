import React, { useState } from "react";
import { ResponsiveLine } from "@nivo/line";
import { Group, Select, useMantineColorScheme } from "@mantine/core";
import { getNivoTooltipTheme } from "../chart-utils";
import { generateWeeklyAverages, getMinMaxValues } from "../../../src/charts/utils";

const multipliedData = [
  { x: "2023-05-19", y: 5411 },
  { x: "2023-05-20", y: 5971 },
  { x: "2023-05-21", y: 5602 },
  { x: "2023-05-22", y: 5409 },
  { x: "2023-05-23", y: 5484 },
  { x: "2023-05-24", y: 5300 },
  { x: "2023-05-25", y: 5646 },
  { x: "2023-05-26", y: 5911 },
  { x: "2023-05-27", y: 5649 },
  { x: "2023-05-28", y: 5888 },
  { x: "2023-05-29", y: 5552 },
  { x: "2023-05-30", y: 5117 },
  { x: "2023-05-31", y: 5157 },
  { x: "2023-06-01", y: 5687 },
  { x: "2023-06-02", y: 5255 },
  { x: "2023-06-03", y: 5156 },
  { x: "2023-06-04", y: 5947 },
  { x: "2023-06-05", y: 5015 },
  { x: "2023-06-06", y: 5269 },
  { x: "2023-06-07", y: 5100 },
  { x: "2023-06-08", y: 5182 },
  { x: "2023-06-09", y: 5733 },
  { x: "2023-06-10", y: 5445 },
  { x: "2023-06-11", y: 5904 },
  { x: "2023-06-12", y: 5545 },
  { x: "2023-06-13", y: 5584 },
  { x: "2023-06-14", y: 5142 },
  { x: "2023-06-15", y: 5396 },
  { x: "2023-06-16", y: 5139 },
  { x: "2023-06-17", y: 5230 },
  { x: "2023-06-18", y: 5339 },
  { x: "2023-06-19", y: 5506 },
  { x: "2023-06-20", y: 5975 },
  { x: "2023-06-21", y: 5097 },
  { x: "2023-06-22", y: 5628 },
  { x: "2023-06-23", y: 5838 },
  { x: "2023-06-24", y: 5803 },
  { x: "2023-06-25", y: 5581 },
  { x: "2023-06-26", y: 5424 },
  { x: "2023-06-27", y: 5036 },
  { x: "2023-06-28", y: 5658 },
  { x: "2023-06-29", y: 5865 },
  { x: "2023-06-30", y: 5969 },
  { x: "2023-07-01", y: 5486 },
  { x: "2023-07-02", y: 5985 },
  { x: "2023-07-03", y: 5526 },
  { x: "2023-07-04", y: 5438 },
  { x: "2023-07-05", y: 5586 },
  { x: "2023-07-06", y: 5730 },
  { x: "2023-07-07", y: 5950 },
  { x: "2023-07-08", y: 5074 },
  { x: "2023-07-09", y: 5492 },
  { x: "2023-07-10", y: 5332 },
  { x: "2023-07-11", y: 5504 },
  { x: "2023-07-12", y: 5975 },
  { x: "2023-07-13", y: 5504 },
  { x: "2023-07-14", y: 5966 },
  { x: "2023-07-15", y: 5427 },
  { x: "2023-07-16", y: 5984 },
  { x: "2023-07-17", y: 5708 },
  { x: "2023-07-18", y: 5781 },
  { x: "2023-07-19", y: 5879 },
  { x: "2023-07-20", y: 5737 },
  { x: "2023-07-21", y: 5014 },
  { x: "2023-07-22", y: 5580 },
  { x: "2023-07-23", y: 5833 },
  { x: "2023-07-24", y: 5025 },
  { x: "2023-07-25", y: 5829 },
  { x: "2023-07-26", y: 5862 },
  { x: "2023-07-27", y: 5176 },
  { x: "2023-07-28", y: 5186 },
  { x: "2023-07-29", y: 5267 },
  { x: "2023-07-30", y: 5519 },
  { x: "2023-07-31", y: 5158 },
  { x: "2023-08-01", y: 5214 },
  { x: "2023-08-02", y: 5067 },
  { x: "2023-08-03", y: 5173 },
  { x: "2023-08-04", y: 5518 },
  { x: "2023-08-05", y: 5355 },
  { x: "2023-08-06", y: 5570 },
  { x: "2023-08-07", y: 5064 },
  { x: "2023-08-08", y: 5283 },
  { x: "2023-08-09", y: 5709 },
  { x: "2023-08-10", y: 5044 },
  { x: "2023-08-11", y: 5983 },
  { x: "2023-08-12", y: 5824 },
  { x: "2023-08-13", y: 5922 },
  { x: "2023-08-14", y: 5135 },
  { x: "2023-08-15", y: 5625 },
  { x: "2023-08-16", y: 5020 },
  { x: "2023-08-17", y: 5397 },
  { x: "2023-08-18", y: 5991 },
  { x: "2023-08-19", y: 5576 },
  { x: "2023-08-20", y: 5958 },
  { x: "2023-08-21", y: 5417 },
  { x: "2023-08-22", y: 5894 },
  { x: "2023-08-23", y: 5278 },
  { x: "2023-08-24", y: 5813 },
  { x: "2023-08-25", y: 5405 },
  { x: "2023-08-26", y: 5294 },
  { x: "2023-08-27", y: 5265 },
  { x: "2023-08-28", y: 5589 },
  { x: "2023-08-29", y: 5864 },
  { x: "2023-08-30", y: 5581 },
  { x: "2023-08-31", y: 5355 },
  { x: "2023-09-01", y: 5288 },
  { x: "2023-09-02", y: 5819 },
  { x: "2023-09-03", y: 5362 },
  { x: "2023-09-04", y: 5062 },
  { x: "2023-09-05", y: 5324 },
  { x: "2023-09-06", y: 5710 },
  { x: "2023-09-07", y: 5878 },
  { x: "2023-09-08", y: 5751 },
  { x: "2023-09-09", y: 5419 },
  { x: "2023-09-10", y: 5432 },
  { x: "2023-09-11", y: 5101 },
  { x: "2023-09-12", y: 5688 },
  { x: "2023-09-13", y: 5465 },
  { x: "2023-09-14", y: 5155 },
  { x: "2023-09-15", y: 5913 },
  { x: "2023-09-16", y: 5456 },
  { x: "2023-09-17", y: 5879 },
  { x: "2023-09-18", y: 5301 },
  { x: "2023-09-19", y: 5058 },
  { x: "2023-09-20", y: 5630 },
  { x: "2023-09-21", y: 5670 },
  { x: "2023-09-22", y: 5992 },
  { x: "2023-09-23", y: 5388 },
  { x: "2023-09-24", y: 5864 },
  { x: "2023-09-25", y: 5650 },
  { x: "2023-09-26", y: 5140 },
  { x: "2023-09-27", y: 5948 },
  { x: "2023-09-28", y: 5905 },
  { x: "2023-09-29", y: 5634 },
  { x: "2023-09-30", y: 5307 },
  { x: "2023-10-01", y: 5120 },
  { x: "2023-10-02", y: 5040 },
  { x: "2023-10-03", y: 5019 },
  { x: "2023-10-04", y: 5094 },
  { x: "2023-10-05", y: 5222 },
  { x: "2023-10-06", y: 5421 },
  { x: "2023-10-07", y: 5619 },
  { x: "2023-10-08", y: 5036 },
  { x: "2023-10-09", y: 5090 },
  { x: "2023-10-10", y: 5141 },
  { x: "2023-10-11", y: 5237 },
  { x: "2023-10-12", y: 5693 },
  { x: "2023-10-13", y: 5357 },
  { x: "2023-10-14", y: 5485 },
  { x: "2023-10-15", y: 5577 },
  { x: "2023-10-16", y: 5474 },
  { x: "2023-10-17", y: 5425 },
  { x: "2023-10-18", y: 5318 },
  { x: "2023-10-19", y: 5668 },
  { x: "2023-10-20", y: 5538 },
  { x: "2023-10-21", y: 5948 },
  { x: "2023-10-22", y: 5252 },
  { x: "2023-10-23", y: 5731 },
  { x: "2023-10-24", y: 5206 },
  { x: "2023-10-25", y: 5908 },
  { x: "2023-10-26", y: 5172 },
  { x: "2023-10-27", y: 5492 },
  { x: "2023-10-28", y: 5050 },
  { x: "2023-10-29", y: 5868 },
  { x: "2023-10-30", y: 5688 },
  { x: "2023-10-31", y: 5473 },
  { x: "2023-11-01", y: 5749 },
  { x: "2023-11-02", y: 5375 },
  { x: "2023-11-03", y: 5811 },
  { x: "2023-11-04", y: 5099 },
  { x: "2023-11-05", y: 5818 },
  { x: "2023-11-06", y: 5767 },
  { x: "2023-11-07", y: 5555 },
  { x: "2023-11-08", y: 5000 },
  { x: "2023-11-09", y: 5380 },
  { x: "2023-11-10", y: 5336 },
  { x: "2023-11-11", y: 5167 },
  { x: "2023-11-12", y: 5222 },
  { x: "2023-11-13", y: 5883 },
  { x: "2023-11-14", y: 5857 },
  { x: "2023-11-15", y: 5535 },
  { x: "2023-11-16", y: 5475 },
  { x: "2023-11-17", y: 5929 },
  { x: "2023-11-18", y: 5289 },
  { x: "2023-11-19", y: 5843 },
  { x: "2023-11-20", y: 5074 },
  { x: "2023-11-21", y: 5934 },
  { x: "2023-11-22", y: 5424 },
  { x: "2023-11-23", y: 5050 },
  { x: "2023-11-24", y: 5109 },
  { x: "2023-11-25", y: 5273 },
  { x: "2023-11-26", y: 5283 },
  { x: "2023-11-27", y: 5508 },
  { x: "2023-11-28", y: 5431 },
  { x: "2023-11-29", y: 5415 },
  { x: "2023-11-30", y: 5450 },
  { x: "2023-12-01", y: 5141 },
  { x: "2023-12-02", y: 5110 },
  { x: "2023-12-03", y: 5764 },
  { x: "2023-12-04", y: 5403 },
  { x: "2023-12-05", y: 5751 },
  { x: "2023-12-06", y: 5187 },
  { x: "2023-12-07", y: 5871 },
  { x: "2023-12-08", y: 5967 },
  { x: "2023-12-09", y: 5680 },
  { x: "2023-12-10", y: 5071 },
  { x: "2023-12-11", y: 5748 },
  { x: "2023-12-12", y: 5187 },
  { x: "2023-12-13", y: 5951 },
  { x: "2023-12-14", y: 5287 },
  { x: "2023-12-15", y: 5594 },
  { x: "2023-12-16", y: 5424 },
  { x: "2023-12-17", y: 5009 },
  { x: "2023-12-18", y: 5245 },
  { x: "2023-12-19", y: 5066 },
  { x: "2023-12-20", y: 5344 },
  { x: "2023-12-21", y: 5928 },
  { x: "2023-12-22", y: 5441 },
  { x: "2023-12-23", y: 5730 },
  { x: "2023-12-24", y: 5705 },
  { x: "2023-12-25", y: 5051 },
  { x: "2023-12-26", y: 5060 },
  { x: "2023-12-27", y: 5211 },
  { x: "2023-12-28", y: 5656 },
  { x: "2023-12-29", y: 5071 },
  { x: "2023-12-30", y: 5849 },
  { x: "2023-12-31", y: 5605 },
  { x: "2024-01-01", y: 5991 },
  { x: "2024-01-02", y: 5278 },
  { x: "2024-01-03", y: 5226 },
  { x: "2024-01-04", y: 5491 },
  { x: "2024-01-05", y: 5078 },
  { x: "2024-01-06", y: 5427 },
  { x: "2024-01-07", y: 5108 },
  { x: "2024-01-08", y: 5557 },
  { x: "2024-01-09", y: 5161 },
  { x: "2024-01-10", y: 5376 },
  { x: "2024-01-11", y: 5854 },
  { x: "2024-01-12", y: 5242 },
  { x: "2024-01-13", y: 5396 },
  { x: "2024-01-14", y: 5140 },
  { x: "2024-01-15", y: 5675 },
  { x: "2024-01-16", y: 5548 },
  { x: "2024-01-17", y: 5549 },
  { x: "2024-01-18", y: 5980 },
  { x: "2024-01-19", y: 5423 },
  { x: "2024-01-20", y: 5831 },
  { x: "2024-01-21", y: 5873 },
  { x: "2024-01-22", y: 5660 },
  { x: "2024-01-23", y: 5413 },
  { x: "2024-01-24", y: 5355 },
  { x: "2024-01-25", y: 5339 },
  { x: "2024-01-26", y: 5924 },
  { x: "2024-01-27", y: 5212 },
  { x: "2024-01-28", y: 5306 },
  { x: "2024-01-29", y: 5809 },
  { x: "2024-01-30", y: 5849 },
  { x: "2024-01-31", y: 5552 },
  { x: "2024-02-01", y: 5877 },
  { x: "2024-02-02", y: 5578 },
  { x: "2024-02-03", y: 5607 },
  { x: "2024-02-04", y: 5550 },
  { x: "2024-02-05", y: 5597 },
  { x: "2024-02-06", y: 5834 },
  { x: "2024-02-07", y: 5151 },
  { x: "2024-02-08", y: 5876 },
  { x: "2024-02-09", y: 5983 },
  { x: "2024-02-10", y: 5006 },
  { x: "2024-02-11", y: 5661 },
  { x: "2024-02-12", y: 5341 },
  { x: "2024-02-13", y: 5985 },
  { x: "2024-02-14", y: 5071 },
  { x: "2024-02-15", y: 5862 },
  { x: "2024-02-16", y: 5385 },
  { x: "2024-02-17", y: 5341 },
  { x: "2024-02-18", y: 5543 },
  { x: "2024-02-19", y: 5231 },
  { x: "2024-02-20", y: 5815 },
  { x: "2024-02-21", y: 5087 },
  { x: "2024-02-22", y: 5830 },
  { x: "2024-02-23", y: 5648 },
  { x: "2024-02-24", y: 5702 },
  { x: "2024-02-25", y: 5679 },
  { x: "2024-02-26", y: 5379 },
  { x: "2024-02-27", y: 5357 },
  { x: "2024-02-28", y: 5211 },
  { x: "2024-02-29", y: 5451 },
  { x: "2024-03-01", y: 5411 },
  { x: "2024-03-02", y: 5824 },
  { x: "2024-03-03", y: 5579 },
  { x: "2024-03-04", y: 5312 },
  { x: "2024-03-05", y: 5623 },
  { x: "2024-03-06", y: 5115 },
  { x: "2024-03-07", y: 5869 },
  { x: "2024-03-08", y: 5881 },
  { x: "2024-03-09", y: 5138 },
  { x: "2024-03-10", y: 5006 },
  { x: "2024-03-11", y: 5065 },
  { x: "2024-03-12", y: 5086 },
  { x: "2024-03-13", y: 5220 },
  { x: "2024-03-14", y: 5774 },
  { x: "2024-03-15", y: 5138 },
  { x: "2024-03-16", y: 5453 },
  { x: "2024-03-17", y: 5590 },
  { x: "2024-03-18", y: 5588 },
  { x: "2024-03-19", y: 5723 },
  { x: "2024-03-20", y: 5062 },
  { x: "2024-03-21", y: 5804 },
  { x: "2024-03-22", y: 5024 },
  { x: "2024-03-23", y: 5247 },
  { x: "2024-03-24", y: 5373 },
  { x: "2024-03-25", y: 5632 },
  { x: "2024-03-26", y: 5817 },
  { x: "2024-03-27", y: 5451 },
  { x: "2024-03-28", y: 5508 },
  { x: "2024-03-29", y: 5878 },
  { x: "2024-03-30", y: 5817 },
  { x: "2024-03-31", y: 5032 },
  { x: "2024-04-01", y: 5383 },
  { x: "2024-04-02", y: 5234 },
  { x: "2024-04-03", y: 5671 },
  { x: "2024-04-04", y: 5139 },
  { x: "2024-04-05", y: 5584 },
  { x: "2024-04-06", y: 5478 },
  { x: "2024-04-07", y: 5106 },
  { x: "2024-04-08", y: 5787 },
  { x: "2024-04-09", y: 5677 },
  { x: "2024-04-10", y: 5293 },
  { x: "2024-04-11", y: 5706 },
  { x: "2024-04-12", y: 5887 },
  { x: "2024-04-13", y: 5256 },
  { x: "2024-04-14", y: 5517 },
  { x: "2024-04-15", y: 5257 },
  { x: "2024-04-16", y: 5692 },
  { x: "2024-04-17", y: 5661 },
  { x: "2024-04-18", y: 5203 },
  { x: "2024-04-19", y: 5514 },
  { x: "2024-04-20", y: 5323 },
  { x: "2024-04-21", y: 5840 },
  { x: "2024-04-22", y: 5194 },
  { x: "2024-04-23", y: 5910 },
  { x: "2024-04-24", y: 5140 },
  { x: "2024-04-25", y: 5547 },
  { x: "2024-04-26", y: 5890 },
  { x: "2024-04-27", y: 5985 },
  { x: "2024-04-28", y: 5290 },
  { x: "2024-04-29", y: 5560 },
  { x: "2024-04-30", y: 5120 },
  { x: "2024-05-01", y: 5407 },
  { x: "2024-05-02", y: 5702 },
  { x: "2024-05-03", y: 5531 },
  { x: "2024-05-04", y: 5184 },
  { x: "2024-05-05", y: 5347 },
  { x: "2024-05-06", y: 5597 },
  { x: "2024-05-07", y: 5791 },
  { x: "2024-05-08", y: 5386 },
  { x: "2024-05-09", y: 5745 },
  { x: "2024-05-10", y: 5340 },
  { x: "2024-05-11", y: 5001 },
  { x: "2024-05-12", y: 5411 },
  { x: "2024-05-13", y: 5400 },
  { x: "2024-05-14", y: 5659 },
  { x: "2024-05-15", y: 5179 },
  { x: "2024-05-16", y: 5659 },
  { x: "2024-05-17", y: 5018 },
];

const PlayersLineChart = ({ data }: { data: Array<any> }) => {
  const { colorScheme } = useMantineColorScheme();
  const [range, setRange] = useState<string>("month");

  const getChartConfig = (amount = "month") => {
    switch (amount) {
      case "month":
        return {
          data: multipliedData.slice(multipliedData.length - 30, multipliedData.length),
          tickValues: "every 2 days",
          bottomAxisLegend: "Days",
        };
      case "3months":
        return {
          data: multipliedData.slice(multipliedData.length - 90, multipliedData.length),
          tickValues: "every 5 days",
          bottomAxisLegend: "Days",
        };
      case "6months":
        return {
          data: generateWeeklyAverages(
            multipliedData.slice(multipliedData.length - 180, multipliedData.length),
          ),
          tickValues: "every 10 days",
          bottomAxisLegend: "Weeks",
        };
      case "12months":
        return {
          data: generateWeeklyAverages(
            multipliedData.slice(multipliedData.length - 360, multipliedData.length),
          ),
          tickValues: 10,
          bottomAxisLegend: "Weeks",
        };
      case "all":
        return {
          data: generateWeeklyAverages(multipliedData),
          tickValues: 10,
          bottomAxisLegend: "Weeks",
        };
    }
  };

  const chartConfig = getChartConfig(range);

  const chartData = [
    {
      id: "players",
      data: chartConfig?.data || [],
    },
  ];
  const { minValue, maxValue } = getMinMaxValues(chartConfig?.data || []);

  console.log(chartData);

  return (
    <div>
      <div style={{ maxWidth: 960, height: 350 }}>
        <ResponsiveLine
          data={chartData}
          margin={{ top: 50, right: 35, bottom: 50, left: 50 }}
          xScale={{
            format: "%Y-%m-%d",
            precision: "day",
            type: "time",
            useUTC: false,
          }}
          yScale={{
            type: "linear",
            min: minValue - (maxValue - minValue) * 0.2,
            max: maxValue + (maxValue - minValue) * 0.2,
          }}
          // yFormat=" >-.2f"
          axisTop={null}
          axisRight={null}
          axisBottom={{
            format: "%b %d",
            // legend: 'time scale',
            legendOffset: 36,
            legendPosition: "middle",
            tickValues: chartConfig?.tickValues,
            legend: chartConfig?.bottomAxisLegend,
          }}
          axisLeft={{
            tickSize: 5,
            tickPadding: 5,
            tickRotation: 0,
            legend: "Ranked players active",
            legendOffset: -45,
            legendPosition: "middle",
          }}
          curve="monotoneX"
          colors={{ scheme: "category10" }}
          enablePoints={true}
          pointSize={8}
          // pointColor={{ theme: "background" }}
          // pointBorderWidth={2}
          pointBorderColor={{ from: "serieColor" }}
          pointLabelYOffset={-12}
          useMesh={true}
          enableGridX={true}
          enableCrosshair={false}
          theme={getNivoTooltipTheme(colorScheme)}
        />
      </div>
      <Group position={"right"}>
        <Select
          style={{ width: 170, marginRight: 30 }}
          label="Display data for the last"
          value={range}
          onChange={(value) => setRange(value as string)}
          data={[
            { value: "month", label: "Month" },
            { value: "3months", label: "3 Months" },
            { value: "6months", label: "6 Months" },
            { value: "12months", label: "12 Months" },
            { value: "all", label: "All" },
          ]}
        />
      </Group>
    </div>
  );
};

export default PlayersLineChart;
